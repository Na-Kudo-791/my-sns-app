{% extends "base.html" %}

{% block title %}ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³{% endblock %}

{% block content %}
<style>
    .post {
        background: white;
        border: 1px solid #ccc;
        padding: 20px;
        margin-bottom: 20px;
        border-radius: 10px;
    }
    .profile-info {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }
    .profile-info img {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        object-fit: cover;
        margin-right: 10px;
    }
    .post img.post-image {
        max-width: 100%;
        margin-top: 10px;
        border-radius: 8px;
    }
    .nav {
        margin-bottom: 20px;
    }
    .nav a {
        margin-right: 15px;
        text-decoration: none;
        color: #333;
    }
    .comments {
        margin-top: 15px;
        padding-left: 15px;
        border-left: 2px solid #eee;
    }
    .comment-form {
        margin-top: 10px;
    }
</style>

<div class="nav">
    <a href="{{ url_for('profile') }}">ãƒã‚¤ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</a>
    <a href="{{ url_for('create_post') }}">æŠ•ç¨¿ã™ã‚‹</a>
    <a href="{{ url_for('logout') }}">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
</div>

<h1>ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</h1>

{% for post in posts %}
    <div class="post">
        <div class="profile-info">
            {% if post['profile_image'] %}
                <img src="{{ url_for('static', filename='uploads/' + post['profile_image']) }}" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ">
            {% else %}
                <img src="{{ url_for('static', filename='default_user.png') }}" alt="ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç”»åƒ">
            {% endif %}

            {# âœ… è‡ªåˆ†ã®æŠ•ç¨¿ãªã‚‰ /profileã€ãã‚Œä»¥å¤–ã¯ /user/<user_id> ã«ãƒªãƒ³ã‚¯ #}
            {% if session['user_id'] == post['user_id'] %}
                <a href="{{ url_for('profile') }}"><strong>{{ post['username'] }}</strong></a>
            {% else %}
                <a href="{{ url_for('user_profile', user_id=post['user_id']) }}"><strong>{{ post['username'] }}</strong></a>
            {% endif %}
        </div>

        <p>{{ post['content'] }}</p>
        {% if post['image'] %}
            <img class="post-image" src="{{ url_for('static', filename='uploads/' + post['image']) }}" alt="æŠ•ç¨¿ç”»åƒ">
        {% endif %}

        <!-- ã„ã„ã­ãƒœã‚¿ãƒ³ -->
        <form action="{{ url_for('like', post_id=post['id']) }}" method="post" style="display:inline;">
            {% if liked_by_user[post['id']] %}
                <button type="submit">â¤ï¸ {{ likes_dict[post['id']] }}</button>
            {% else %}
                <button type="submit">ğŸ¤ {{ likes_dict[post['id']] }}</button>
            {% endif %}
        </form>

        <!-- ã‚³ãƒ¡ãƒ³ãƒˆè¡¨ç¤º -->
        <div class="comments">
            <h5>ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§:</h5>
            {% for comment in comments_dict[post['id']] %}
                <p><strong>{{ comment['username'] }}:</strong> {{ comment['content'] }}</p>
            {% endfor %}
        </div>

        <!-- ã‚³ãƒ¡ãƒ³ãƒˆæŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ  -->
        <form class="comment-form" method="post" action="{{ url_for('comment', post_id=post['id']) }}">
            <input type="text" name="comment" placeholder="ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›¸ã" required>
            <button type="submit">é€ä¿¡</button>
        </form>
    </div>
{% endfor %}

{% if not posts %}
    <p>æŠ•ç¨¿ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
{% endif %}
{% endblock %}
